# 📘 가계도 시각화 코드 가이드 (CODE_GUIDE.md)

이 문서는 **가계도 시각화 프로젝트**의 소스 코드를 누구나 쉽게 이해할 수 있도록 설명한 가이드입니다. 자바스크립트 문법을 완벽히 모르더라도, 전체적인 흐름과 각 파일이 무슨 역할을 하는지 파악할 수 있도록 작성되었습니다.

---

## 🏗️ 전체 구조 (Architecture)

이 프로젝트는 **"역할 분담"**이 아주 잘 되어 있습니다. 코드를 한 파일에 몰아넣지 않고, 기능별로 나누어 관리합니다. 이를 **MVC 패턴**과 비슷하다고 볼 수 있습니다.

*   **Models (데이터 모델)**: 사람, 부부와 같은 **데이터의 형태**를 정의합니다. (붕어빵 틀과 같습니다.)
*   **Services (서비스)**: 엑셀을 읽거나, 가계도 위치를 계산하는 **핵심 작업**을 수행합니다. (붕어빵을 굽는 기계입니다.)
*   **View (뷰)**: 계산된 결과를 **화면에 그려주는** 역할을 합니다. (완성된 붕어빵을 접시에 담아 보여줍니다.)
*   **App (앱)**: 이 모든 것을 **연결하고 조종**하는 지휘자입니다.

---

## 📂 폴더 및 파일 상세 설명

### 1. `js/models/` (데이터의 기본 단위)

#### 🧑 `person.js` (Person 클래스)
*   **역할**: '사람' 한 명에 대한 정보를 담는 그릇입니다.
*   **주요 속성**:
    *   `name`: 이름 (예: "홍길동")
    *   `birthYear`: 태어난 해 (예: "1980")
    *   `gender`: 성별 ("남" 또는 "여")
    *   `isBlood`: 직계 가족인지 여부 (나중에 그래프를 그릴 때 테두리 색을 다르게 하기 위해 사용합니다.)

#### 💑 `couple.js` (Couple 클래스)
*   **역할**: '부부' 관계를 정의합니다.
*   **주요 속성**:
    *   `spouse1`, `spouse2`: 부부 두 사람의 이름
    *   `children`: 이 부부 사이에서 태어난 자녀들의 이름 목록
*   **특징**: 부부는 가계도에서 나란히 붙어 있어야 하므로, 별도의 모델로 관리하여 위치를 계산할 때 사용합니다.

---

### 2. `js/services/` (핵심 일꾼들)

#### 📄 `data-loader.js` (DataLoader 클래스)
*   **역할**: 사용자가 업로드한 **엑셀 파일을 읽어서 자바스크립트가 이해할 수 있는 데이터로 변환**해줍니다.
*   **작동 방식**:
    1.  엑셀 파일을 엽니다.
    2.  '이름', '성별', '부모', '자식' 같은 컬럼이 있는 시트를 찾습니다.
    3.  이 데이터를 읽기 좋은 형태(JSON)로 바꿔서 반환합니다.

#### 🌳 `graph-builder.js` (GraphBuilder 클래스) **[가장 중요!]**
*   **역할**: 엉켜있는 가족 관계 데이터를 풀어서 **"누가 어디에 위치해야 하는지"** 계산하는 **두뇌** 역할을 합니다.
*   **핵심 알고리즘 (Depth-Based Merging)**:
    1.  **피벗(Pivot) 찾기**: 가족 중 가장 연결이 많은 사람(핵심 인물)을 찾습니다. 이 사람을 기준으로 삼습니다.
    2.  **세대(Depth) 계산**: 피벗을 0세대로 두고, 부모는 +1세대, 자식은 -1세대로 계산하여 위아래 층을 나눕니다.
    3.  **위치(Position) 계산**:
        *   같은 세대인 사람들을 모읍니다.
        *   형제자매끼리 뭉치게 합니다.
        *   부부는 서로 옆에 딱 붙여놓습니다.
        *   선이 꼬이지 않도록 순서를 영리하게 정렬합니다.
    4.  **결과 생성**: 최종적으로 "누구는 (x, y) 좌표에 있어라"라는 정보를 만들어냅니다.

---

### 3. `js/view/` (화면 담당)

#### 🎨 `renderer.js` (Renderer 클래스)
*   **역할**: `GraphBuilder`가 계산한 위치 정보를 바탕으로 **실제 화면에 그림을 그립니다.**
*   **사용 도구**: `Cytoscape.js`라는 라이브러리를 사용하여 멋진 그래프를 그립니다.
*   **스타일링**:
    *   남자는 파란색 배경, 여자는 분홍색 배경
    *   직계 가족은 검은 테두리, 인척(며느리, 사위 등)은 빨간 테두리
    *   부부 사이는 붉은 선으로 연결
*   **물리 효과**: 마우스로 사람을 끌어당기면(Drag), 스프링처럼 띠용~ 하고 움직이는 효과(Physics)도 여기서 담당합니다.

---

### 4. `js/app.js` (지휘자)

#### 🎬 `App` 클래스
*   **역할**: 프로그램이 시작되면 가장 먼저 실행됩니다.
*   **하는 일**:
    1.  "파일 업로드 버튼을 감시해라"라고 명령을 내립니다.
    2.  파일이 들어오면 -> `DataLoader`에게 "읽어!"라고 시킵니다.
    3.  데이터가 오면 -> `GraphBuilder`에게 "위치 계산해!"라고 시킵니다.
    4.  계산이 끝나면 -> `Renderer`에게 "그려!"라고 시킵니다.

---

## 🎨 CSS 스타일 (`css/styles.css`)

*   **화면 꾸미기**: 버튼의 모양, 전체적인 레이아웃, 배경색 등을 정의합니다.
*   **반응형**: 화면 크기에 따라 적절하게 보이도록 조절합니다.
*   **Cytoscape**: 그래프 자체의 스타일(동그라미 색깔 등)은 `renderer.js` 안에 자바스크립트로 정의되어 있어서 CSS 파일에는 많이 없습니다.

---

## 💡 코드를 수정하고 싶다면?

*   **사람 동그라미 색을 바꾸고 싶어요!**
    *   👉 `js/view/renderer.js` 파일에서 `background-color` 부분을 찾아서 수정하세요.
*   **가계도 계산 방식이 이상해요!**
    *   👉 `js/services/graph-builder.js` 파일이 핵심입니다. 여기서 로직을 수정해야 합니다.
*   **엑셀 파일 형식을 바꾸고 싶어요!**
    *   👉 `js/services/data-loader.js` 파일에서 컬럼 이름을 확인하는 부분을 수정하세요.

이 가이드가 여러분의 코딩 탐험에 도움이 되기를 바랍니다! 🚀
